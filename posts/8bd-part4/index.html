<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>8bit Duels Devlog Part 4 | ThousandthStar's blog</title><meta name=keywords content><meta name=description content="Hello! Welcome to the fourth part of my devlog where I develop my multiplayer turn-based game. I previously didn&rsquo;t have a name, but I have decided to name it 8bit Duels! I think this fits the theme pretty nicely. Anyways, on with the devlog!
Refactoring This devlog is all about refactoring, and how I made my code cleaner. I did this by creating a workspace shared between the client and the server."><meta name=author content><link rel=canonical href=https://thousandthstar.github.io/posts/8bd-part4/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://thousandthstar.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://thousandthstar.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://thousandthstar.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://thousandthstar.github.io/apple-touch-icon.png><link rel=mask-icon href=https://thousandthstar.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZP55MZZT7E"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZP55MZZT7E",{anonymize_ip:!1})}</script><meta property="og:title" content="8bit Duels Devlog Part 4"><meta property="og:description" content="Hello! Welcome to the fourth part of my devlog where I develop my multiplayer turn-based game. I previously didn&rsquo;t have a name, but I have decided to name it 8bit Duels! I think this fits the theme pretty nicely. Anyways, on with the devlog!
Refactoring This devlog is all about refactoring, and how I made my code cleaner. I did this by creating a workspace shared between the client and the server."><meta property="og:type" content="article"><meta property="og:url" content="https://thousandthstar.github.io/posts/8bd-part4/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-02T18:17:24-05:00"><meta property="article:modified_time" content="2022-12-02T18:17:24-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="8bit Duels Devlog Part 4"><meta name=twitter:description content="Hello! Welcome to the fourth part of my devlog where I develop my multiplayer turn-based game. I previously didn&rsquo;t have a name, but I have decided to name it 8bit Duels! I think this fits the theme pretty nicely. Anyways, on with the devlog!
Refactoring This devlog is all about refactoring, and how I made my code cleaner. I did this by creating a workspace shared between the client and the server."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://thousandthstar.github.io/posts/"},{"@type":"ListItem","position":2,"name":"8bit Duels Devlog Part 4","item":"https://thousandthstar.github.io/posts/8bd-part4/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"8bit Duels Devlog Part 4","name":"8bit Duels Devlog Part 4","description":"Hello! Welcome to the fourth part of my devlog where I develop my multiplayer turn-based game. I previously didn\u0026rsquo;t have a name, but I have decided to name it 8bit Duels! I think this fits the theme pretty nicely. Anyways, on with the devlog!\nRefactoring This devlog is all about refactoring, and how I made my code cleaner. I did this by creating a workspace shared between the client and the server.","keywords":[],"articleBody":"Hello! Welcome to the fourth part of my devlog where I develop my multiplayer turn-based game. I previously didn’t have a name, but I have decided to name it 8bit Duels! I think this fits the theme pretty nicely. Anyways, on with the devlog!\nRefactoring This devlog is all about refactoring, and how I made my code cleaner. I did this by creating a workspace shared between the client and the server. This allows me to directly serialize and deserialize packets into ClientMessage and ServerMessage enum variants. One reason I adore Rust is because you can pass parameters to some enums. This is great in my case, as I need to send some data between the client and the server. These changes were suggested by a user in the Rust gamedev Discord server (link to their website).\nThis refactoring was done over most of the networking code, so I won’t show everything here. The code is on Github here if you want to check it out (stars are greatly appreciated).\nThe main thing is that I now need less logic to handle packets. Before, I was creating some raw JSON in the client and putting a packet-type value in the object. I was then matching that value on the server-side, and vice-versa. This is an extremely bad practice, and it resulted in longer tedious code, since I needed to also get the other variables in the packets by their name in the JSON object. Now, I’ve just created a shared common package along with the client and server packages. It contains these simple API packets:\n#[derive(Serialize, Deserialize, Debug)] pub enum ServerMessage { // 1st param: whether or not the player is player_1 StartGame(bool), StartTurn, // 1st param: the `CardEntity` to spawn SpawnCard(CardEntity), /* 1st param: the initial x position 2nd param: the initial y position 3rd param: the final x position 4th param: the final y position */ MoveTroop(i32, i32, i32, i32), AttackTroop(i32, i32, i32, i32), } #[derive(Serialize, Deserialize, Debug)] pub enum ClientMessage { Deck(Vec\u003cCard\u003e), MoveTroop(i32, i32, i32, i32), AttackTroop(i32, i32, i32, i32), } Using serde_json, a great JSON library, I can just serialize and deserialize packets into enum variants. These are handled like so on the client (I removed, the logic, since it’s very straightforward):\nif let Some(message) = guard.pop_front() { match message { ServerMessage::StartGame(is_player_1) =\u003e { // Starting the game } ServerMessage::SpawnCard(card_entity) =\u003e { // Spawning troops } ServerMessage::MoveTroop(start_x, start_y, end_x, end_y) =\u003e { // Moving troops } ServerMessage::AttackTroop(start_x, start_y, end_x, end_y) =\u003e { // Attacking troops } _ =\u003e {} } } On the server, we have something similar, but with ClientMessage instead.\nConclusion If you made it this far, thanks again for reading! This devlog was pretty short since there wasn’t much to explain. I do plan on finishing this game as soon as possible, but I am very busy at the moment, so progress is very slow. With that, I hope you enjoyed and are somewhat hoping to try out my game in the future. See you next time!\nSpecial thanks to the user who helped me improve my code. Hints on grammar and best practices are always greatly appreciated.\n","wordCount":"525","inLanguage":"en","datePublished":"2022-12-02T18:17:24-05:00","dateModified":"2022-12-02T18:17:24-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://thousandthstar.github.io/posts/8bd-part4/"},"publisher":{"@type":"Organization","name":"ThousandthStar's blog","logo":{"@type":"ImageObject","url":"https://thousandthstar.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://thousandthstar.github.io/ accesskey=h title="ThousandthStar's blog (Alt + H)">ThousandthStar's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>8bit Duels Devlog Part 4</h1><div class=post-meta><span title='2022-12-02 18:17:24 -0500 -0500'>December 2, 2022</span></div></header><div class=post-content><p>Hello! Welcome to the fourth part of my devlog where I develop my multiplayer turn-based game. I previously didn&rsquo;t have a name, but I have decided to name it 8bit Duels! I think this fits the theme pretty nicely. Anyways, on with the devlog!</p><h3 id=refactoring>Refactoring<a hidden class=anchor aria-hidden=true href=#refactoring>#</a></h3><p>This devlog is all about refactoring, and how I made my code cleaner. I did this by creating a workspace shared between the client and the server. This allows me to directly serialize and deserialize packets into <code>ClientMessage</code> and <code>ServerMessage</code> enum variants. One reason I adore Rust is because you can pass parameters to some enums. This is great in my case, as I need to send some data between the client and the server. These changes were suggested by a user in the Rust gamedev Discord server (<a href=https://gamedev.rs/>link to their website</a>).</p><p>This refactoring was done over most of the networking code, so I won&rsquo;t show everything here. The code is on Github <a href=https://github.com/ThousandthStar/8bit-duels>here</a> if you want to check it out (stars are greatly appreciated).</p><p>The main thing is that I now need less logic to handle packets. Before, I was creating some raw JSON in the client and putting a <code>packet-type</code> value in the object. I was then matching that value on the server-side, and vice-versa. This is an extremely bad practice, and it resulted in longer tedious code, since I needed to also get the other variables in the packets by their name in the JSON object. Now, I&rsquo;ve just created a shared <code>common</code> package along with the client and server packages. It contains these simple API packets:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[derive(Serialize, Deserialize, Debug)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>ServerMessage</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1st param: whether or not the player is player_1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    StartGame(<span style=color:#66d9ef>bool</span>),
</span></span><span style=display:flex><span>    StartTurn,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1st param: the `CardEntity` to spawn
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    SpawnCard(CardEntity),
</span></span><span style=display:flex><span>    <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>    1st param: the initial x position
</span></span></span><span style=display:flex><span><span style=color:#75715e>    2nd param: the initial y position
</span></span></span><span style=display:flex><span><span style=color:#75715e>    3rd param: the final   x position
</span></span></span><span style=display:flex><span><span style=color:#75715e>    4th param: the final   y position
</span></span></span><span style=display:flex><span><span style=color:#75715e>    */</span>
</span></span><span style=display:flex><span>    MoveTroop(<span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>),
</span></span><span style=display:flex><span>    AttackTroop(<span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>),
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[derive(Serialize, Deserialize, Debug)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>ClientMessage</span> {
</span></span><span style=display:flex><span>    Deck(Vec<span style=color:#f92672>&lt;</span>Card<span style=color:#f92672>&gt;</span>),
</span></span><span style=display:flex><span>    MoveTroop(<span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>),
</span></span><span style=display:flex><span>    AttackTroop(<span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>, <span style=color:#66d9ef>i32</span>),
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Using <code>serde_json</code>, a great JSON library, I can just serialize and deserialize packets into enum variants. These are handled like so on the client (I removed, the logic, since it&rsquo;s very straightforward):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Some(message) <span style=color:#f92672>=</span> guard.pop_front() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>match</span> message {
</span></span><span style=display:flex><span>            ServerMessage::StartGame(is_player_1) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Starting the game
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            }
</span></span><span style=display:flex><span>            ServerMessage::SpawnCard(card_entity) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Spawning troops
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            }
</span></span><span style=display:flex><span>            ServerMessage::MoveTroop(start_x, start_y, end_x, end_y) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Moving troops
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            }
</span></span><span style=display:flex><span>            ServerMessage::AttackTroop(start_x, start_y, end_x, end_y) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Attacking troops
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            }
</span></span><span style=display:flex><span>            _ <span style=color:#f92672>=&gt;</span> {}
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>On the server, we have something similar, but with <code>ClientMessage</code> instead.</p><h3 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h3><p>If you made it this far, thanks again for reading! This devlog was pretty short since there wasn&rsquo;t much to explain. I do plan on finishing this game as soon as possible, but I am very busy at the moment, so progress is very slow. With that, I hope you enjoyed and are somewhat hoping to try out my game in the future. See you next time!</p><p><strong>Special thanks to the user who helped me improve my code. Hints on grammar and best practices are always greatly appreciated.</strong></p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://thousandthstar.github.io/>ThousandthStar's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>